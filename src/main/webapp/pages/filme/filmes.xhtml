<ui:composition template="../../WEB-INF/template/template.xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">
	
	<ui:define name="conteudo">
	
		<h:outputStylesheet library="css" name="filmes.css" />
		<h:form id="form">
		    <p:panel id="panel-filme" header="Filmes">
		    	<f:facet name="actions">    
		        	<p:commandButton styleClass="botao-novo" icon="fa fa-plus" actionListener="#{filmeBean.novo}" 
		        		oncomplete="PF('dlgFilme').show();" update="dlg-filme" />
				</f:facet>
				
				<p:dataTable value="#{filmeBean.filmes}" var="filme" id="tabela-filme"
					paginator="true" paginatorPosition="bottom" widgetVar="filmesTabela" rows="3"
					rowStyleClass="#{filme.tem == true ? null : 'red'}"
					emptyMessage="Nenhum registro foi encontrado.">
					
					<p:column styleClass="coluna-imagem" headerText="Poster">
						<o:graphicImage value="#{imagesFilme.get(filme.id)}"
							lastModified="#{filmeBean.getUltimaModificaoFoto(filme.id)}" height="150" />
					</p:column>
					
					<p:column headerText="Nome" styleClass="coluna-nome" sortBy="#{filme.nome}"
						filterBy="#{filme.nome}">
						<h:outputText value="#{filme.nome}" />
					</p:column>
					
					<p:column headerText="Ano lan&#231;amento" styleClass="coluna-ano-lancamento"
						filterBy="#{filme.anoLancamneto}">
						<h:outputText value="#{filme.anoLancamneto}" />
					</p:column>
					
					<p:column headerText="Classifica&#231;&#227;o" styleClass="coluna-classificacao">
						<h:outputText value="#{filme.tipoClassificacao.label}" />
					</p:column>
					
					<p:column headerText="Dura&#231;&#227;o" styleClass="coluna-duracao">
						<h:outputText value="#{filme.duracao}" />
					</p:column>
					
					<p:column headerText="Tem" styleClass="coluna-tem" sortBy="#{filme.tem}">
						<p:selectBooleanCheckbox value="#{filme.tem}">
							<p:ajax partialSubmit="true" resetValues="true" listener="#{filmeBean.atualizarCheck(filme, filme.tem)}"
								update="form:tabela-filme" />
						</p:selectBooleanCheckbox>
					</p:column>
					
					<p:column headerText="Assistiu" styleClass="coluna-assistir" sortBy="#{filme.assistiu}">
						<p:selectBooleanCheckbox value="#{filme.assistiu}">
							<p:ajax partialSubmit="true" resetValues="true" listener="#{filmeBean.atualizarAssistiuCheck(filme, filme.assistiu)}"
								update="form:tabela-filme" />
						</p:selectBooleanCheckbox>
					</p:column>
					
					<p:column headerText="Op&#231;&#245;es" styleClass="coluna-opcao">
						<p:commandButton icon="fa fa-edit" oncomplete="PF('dlgFilme').show();" update="dlg-filme">
							<f:setPropertyActionListener value="#{filme}" target="#{filmeBean.filme}" />
						</p:commandButton>
						
						<p:commandButton icon="fa fa-trash" update="form" process="@this"
							action="#{filmeBean.remove()}">
							<f:setPropertyActionListener value="#{filme}" target="#{filmeBean.filme}" />
							
							<p:confirm header="Excluir" message="Confirma exclus&#227;o?" icon="ui-icon-alert" />
							<p:confirmDialog header="Exluir" global="true" showEffect="fade" hideEffect="fade">
								<p:commandButton  value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
					     		<p:commandButton value="N&#227;o" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
					   		</p:confirmDialog>
						</p:commandButton>
						
						<p:commandButton icon="fa fa-image" oncomplete="PF('dlgImagem').show();" update="form-imagem:panel-imagem">
							<f:setPropertyActionListener value="#{filme}" target="#{filmeBean.filme}" />						
						</p:commandButton>
					</p:column>
					
					<f:facet name="footer">
				        No total h&#225; #{fn:length(filmeBean.filmes)} filmes.
				    </f:facet>
				</p:dataTable>
			
			</p:panel>
		</h:form>
		
		<p:dialog widgetVar="dlgFilme" id="dlg-filme" modal="true" resizable="fasle" header="Filme">
			<h:form id="form-filme">
				<p:panel id="panel-filme">
					<h:panelGrid columns="2">
						<p:outputLabel for="nome" value="Nome:" />
						<p:inputText id="nome" value="#{filmeBean.filme.nome}" required="true" />
						
						<p:outputLabel for="ano" value="Ano lan&#231;amento:" />
						<p:inputText id="ano" value="#{filmeBean.filme.anoLancamneto}" required="true" decimalPlaces="0" />
						
						<p:outputLabel for="duracao" value="Dura&#231;&#227;o:" />
						<pe:timePicker id="duracao" mode="popup" value="#{filmeBean.filme.duracao}" />
						
						<p:outputLabel for="classificacao" value="Classifica&#231;&#227;o:" />
						<p:selectOneMenu id="classificacao" value="#{filmeBean.filme.tipoClassificacao}" style="width:150px">
			               <f:selectItems value="#{filmeBean.tipoClassificacaos}" var="t" itemLabel="#{t.label}" itemValue="#{t}" />                               
			            </p:selectOneMenu>
					</h:panelGrid>
					
					<p:commandButton value="Save" action="#{filmeBean.save()}" update="form:tabela-filme form-filme:panel-filme" style="float: right" />
				</p:panel>
			</h:form>
		</p:dialog>
		
		<p:dialog widgetVar="dlgImagem" id="dlg-imagem" modal="true" resizable="fasle" header="Imagem">
			<h:form id="form-imagem">
				<p:panel id="panel-imagem">
					<h:panelGrid columns="2">
						<p:outputLabel for="nome" value="Nome:" />
						<p:inputText id="nome" value="#{filmeBean.filme.nome}" disabled="true" size="32" />
					</h:panelGrid>
					<h:panelGrid columns="1">
						<p:fileUpload fileUploadListener="#{filmeBean.uploadImagem}" mode="advanced" dragDropSupport="false"
           					sizeLimit="1000000" fileLimit="1" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
					</h:panelGrid>		
				</p:panel>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>